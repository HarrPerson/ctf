# Pentesting Fundamentals [link](https://tryhackme.com/room/pentestingfundamentals)

## What is Penetration Testing? 

A Penetration test or pentest is an ethically-driven attempt to test and analyse the security defences to protect these assets and pieces of information. A penetration test involves using the same tools, techniques, and methodologies that someone with malicious intent would use and is similar to an audit.

## Penetration Testing Ethics 

Recall that a penetration test is an **authorised audit** of a computer system's security and defences as agreed by the owners of the systems. The legality of penetration is pretty clear-cut in this sense; anything that falls outside of this agreement is deemed unauthorised.

Before a penetration test starts, a formal discussion occurs between the penetration tester and the system owner. Various tools, techniques, and systems to be tested are agreed on. This discussion **forms the scope of the penetration testing agreement** and will determine the course the penetration test takes.

Companies that provide penetration testing services are held against legal frameworks and industry accreditation. For example, the National Cyber Security Centre (NCSC) has the CHECK accreditation scheme in the UK. This check means that only "[CHECK]  approved companies can conduct authorised penetration tests of public sector and CNI systems and networks." (NCSC).

### Rules of Engagement (ROE)

The ROE is a document that is created at the initial stages of a penetration testing engagement. This document consists of three main sections (explained in the table below), which are ultimately responsible for deciding how the engagement is carried out. The SANS institute has a great example of this document which you can view online [here](https://sansorg.egnyte.com/dl/bF4I3yCcnt/?).

#### Permission

This section of the document gives explicit permission for the engagement to be carried out. This permission is essential to legally protect individuals and organisations for the activities they carry out.

#### Test Scope

This section of the document will annotate specific targets to which the engagement should apply. For example, the penetration test may only apply to certain servers or applications but not the entire network.

#### Rules

The rules section will define exactly the techniques that are permitted during the engagement. For example, the rules may specifically state that techniques such as phishing attacks are prohibited, but MITM (Man-in-the-Middle) attacks are okay.

## Penetration Testing Methodologies 

#### Information Gathering	

This stage involves collecting as much publically accessible information about a target/organisation as possible, for example, OSINT and research.

Note: This does not involve scanning any systems.

#### Enumeration/Scanning

This stage involves discovering applications and services running on the systems. For example, finding a web server that may be potentially vulnerable.

#### Exploitation

This stage involves leveraging vulnerabilities discovered on a system or application. This stage can involve the use of public exploits or exploiting application logic.

#### Privilege Escalation

Once you have successfully exploited a system or application (known as a foothold), this stage is the attempt to expand your access to a system. You can escalate horizontally and vertically, where horizontally is accessing another account of the same permission group (i.e. another user), whereas vertically is that of another permission group (i.e. an administrator).

#### Post-exploitation	

This stage involves a few sub-stages:

1. What other hosts can be targeted (pivoting)

2. What additional information can we gather from the host now that we are a privileged user

3.  Covering your tracks

4. Reporting

## OSSTMM

[The Open Source Security Testing Methodology Manual](https://www.isecom.org/OSSTMM.3.pdf)

## OWASP

[Open Web Application Security Project](https://owasp.org/)

[Reports](https://owasp.org/www-project-top-ten/2017/)

## NIST Cybersecurity Framework 1.1

[NIST Cybersecurity Framework](https://www.nist.gov/cyberframework)


## NCSC CAF

[Cyber Assessment Framework](https://www.ncsc.gov.uk/collection/caf/caf-principles-and-guidance)

# Principles of Security

## The CIA Triad 

Consisting of three sections: **C**onfidentiality, **I**ntegrity and **A**vailability (**CIA**), this model has quickly become an industry standard today. 

### Confidentiality

This element is the protection of data from unauthorized access and misuse. Organisations will always have some form of sensitive data stored on their systems. To provide confidentiality is to protect this data from parties that it is not intended for.

There are many real-world examples for this, for example, employee records and accounting documents will be considered sensitive. Confidentiality will be provided in the sense that only HR administrators will access employee records, where vetting and tight access controls are in place. Accounting records are less valuable (and therefore less sensitive), so not as stringent access controls would be in place for these documents. Or, for example, governments using a sensitivity classification rating system (top-secret, classified, unclassified)


### Integrity

The CIA triad element of integrity is the condition where information is kept accurate and consistent unless authorized changes are made. It is possible for the information to change because of careless access and use, errors in the information system, or unauthorized access and use. In the CIA triad, integrity is maintained when the information remains unchanged during storage, transmission, and usage not involving modification to the information. Steps must be taken to ensure data cannot be altered by unauthorised people (for example, in a breach of confidentiality).

Many defences to ensure integrity can be put in place. Access control and rigorous authentication can help prevent authorized users from making unauthorized changes. Hash verifications and digital signatures can help ensure that transactions are authentic and that files have not been modified or corrupted.

### Availability

In order for data to be useful, it must be available and accessible by the user.

The main concern in the CIA triad is that the information should be available when authorised users need to access it.

Availability is very often a key benchmark for an organisation. For example, having 99.99% uptime on their websites or systems (this is laid out in Service Level Agreements). When a system is unavailable, it often results in damage to an organisations reputation and loss of finances. Availability is achieved through a combination of many elements, including:

- Having reliable and well-tested hardware for their information technology servers (i.e. reputable servers)
- Having redundant technology and services in the case of failure of the primary
- Implementing well-versed security protocols to protect technology and services from attack

## Principles of Privileges 

It is vital to administrate and correctly define the various levels of access to an information technology system individuals require. 

The levels of access given to individuals are determined on two primary factors:

- The individual's role/function within the organisation
- The sensitivity of the information being stored on the system

Two key concepts are used to assign and manage the access rights of individuals, two key concepts are used: Privileged Identity Management (PIM) and Privileged Access Management (or PAM for short).
 
**Principle of least privilege**:  users should be given the minimum amount of privileges, and only those that are absolutely necessary for them to perform their duties.


## Threat Modelling & Incident Response

The threat modelling process is very similar to a risk assessment made in workplaces for employees and customers. The principles all return to:

- Preparation
- Identification
- Mitigations
- Review


It is, however, a complex process that needs constant review and discussion with a dedicated team. An effective threat model includes:

    The threat modelling process is very similar to a risk assessment made in workplaces for employees and customers. The principles all return to:

    Preparation
    Identification
    Mitigations
    Review


It is, however, a complex process that needs constant review and discussion with a dedicated team. An effective threat model includes:

- Threat intelligence
- Asset identification
- Mitigation capabilities
- Risk assessmentThreat intelligence
    Asset identification
    Mitigation capabilities
    Risk assessment

### STRIDE (**S**poofing, identity, **T**ampering with data, **R**epudiation threats, **I**nformation disclosure, **D**enial of Service and **E**levation of privileges)

#### Spoofing	

This principle requires you to authenticate requests and users accessing a system. Spoofing involves a malicious party falsely identifying itself as another.

Access keys (such as API keys) or signatures via encryption helps remediate this threat.

#### Tampering	

By providing anti-tampering measures to a system or application, you help provide integrity to the data. Data that is accessed must be kept integral and accurate.

For example, shops use seals on food products.

#### Repudiation	

This principle dictates the use of services such as logging of activity for a system or application to track.
Information Disclosure	Applications or services that handle information of multiple users need to be appropriately configured to only show information relevant to the owner is shown.

#### Denial of Service

Applications and services use up system resources, these two things should have measures in place so that abuse of the application/service won't result in bringing the whole system down.

#### Elevation of Privilege

This is the worst-case scenario for an application or service. It means that a user was able to escalate their authorization to that of a higher level i.e. an administrator. This scenario often leads to further exploitation or information disclosure.


### Computer Security Incident Response Team (CSIRT)

#### Preparation

  Do we have the resources and plans in place to deal with the security incident?

#### Identification

  Has the threat and the threat actor been correctly identified in order for us to respond to?

#### Containment

  Can the threat/security incident be contained to prevent other systems or users from being impacted?

#### Eradication

  Remove the active threat.

#### Recovery

  Perform a full review of the impacted systems to return to business as usual operations.

#### Lessons Learned

  What can be learnt from the incident? I.e. if it was due to a phishing email, employees should be trained better to detect phishing emails.
